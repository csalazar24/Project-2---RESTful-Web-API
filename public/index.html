<!DOCTYPE html>
<script>
window.addEventListener("DOMContentLoaded", function () {

    document.querySelector("#showAll").addEventListener("click", async function getAllPokemons() {
        
        var html = "<ul>" ;
	    const response = await fetch('/api/pokedex');
        const pokemons = await response.json();
        for (const poke of pokemons) {
		     html += `<li> ${poke.no}, ${poke.name}, ${poke.species}, ${poke.height}, ${poke.weight}, ${poke.type}</li>`;
        }
        html += "</ul>";

        document.querySelector("#pkmnList").innerHTML = html;
    }); 

    document.querySelector("#Insert").addEventListener("click", async function insertPokemon() {
        
        const newNo = document.querySelector("#inNum").value;
        const newName = document.querySelector("#inName").value; 
        const newSpecies = document.querySelector("#inSpecies").value;
        const newHeight = document.querySelector("#inHeight").value;
        const newWeight = document.querySelector("#inWeight").value;
        const newType = document.querySelector("#inType").value;    
        
        const poke = { no: newNo, name: newName, species: newSpecies, height: newHeight, weight: newWeight, type: [newType] };

        const response = await fetch('/api/pokedex/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(poke)
        });

        // ok is true if status is 200-299
        if (response.ok) {
            const poke = await response.json();
            console.log('Added student with No. ' + poke.no);
        }
        else {
            const err = await response.json();
            console.log('Error:', err);
        }

    }); 


    document.querySelector("#searchBtn").addEventListener("click", async function getOnePokemon() {
        
        var searchInput = document.querySelector("#search").value;
        var searchOption = document.querySelector("#searchBy");
        var selectedOption = searchOption.options[searchOption.selectedIndex].value;
        var html;

       if(selectedOption == "ID") {
            const response = await fetch(`/api/pokedex/${searchInput}`);
            const poke = await response.json();

            html = `${poke.no}, ${poke.name}, ${poke.species}, ${poke.height}, ${poke.weight}, ${poke.type}`

           
        }
        else{
            const response = await fetch(`/api/pokedex?name=${searchInput}`);
            const poke = await response.json();
            html = `${poke[0].no}, ${poke[0].name}, ${poke[0].species}, ${poke[0].height}, ${poke[0].weight}, ${poke[0].type}`

        }

        document.querySelector("#pkmnList").innerHTML = html;

    });

    document.querySelector("#deleteBtn").addEventListener("click", async function deletePokemon() {

        var deleteInput = document.querySelector("#delete").value;
       

        const response = await fetch('/api/pokedex/' + deleteInput, {
            method: 'DELETE',
           
        });

    if (response.ok) {
		document.querySelector("#pkmnList").innerHTML = "Pokemon Successfully Deleted";
	}
	else {
		const err = await response.json();
		console.log('Error:', err);
	}

    }); 


    document.querySelector("#Update").addEventListener("click", async function updatePokemon() {

        var UpdateInputID = document.querySelector("#upID").value;

        const newNo = document.querySelector("#upNum").value;
        const newName = document.querySelector("#upName").value; 
        const newSpecies = document.querySelector("#upSpecies").value;
        const newHeight = document.querySelector("#upHeight").value;
        const newWeight = document.querySelector("#upWeight").value;
        const newType = document.querySelector("#upType").value;   

        const poke = { no: newNo, name: newName, species: newSpecies, height: newHeight, weight: newWeight, type: [newType] };

        const response = await fetch('/api/pokedex/' + UpdateInputID, {
            method: 'PUT',
		headers: {
			'Content-Type': 'application/json'
		},
        body: JSON.stringify(poke)
           
        });

        if (response.ok) {
            document.querySelector("#pkmnList2").innerHTML = "Pokemon Successfully Updated";
	}
	else {
		const err = await response.json();
		console.log('Error:', err);
	}

    }); 

    


});


  
</script>
<html lang="en">
    <h1>Pokedex</h1>
    <p>
        See Pokedex<button id="showAll">GO</button>
    </p>

    <p>
        <label for="searchBy"> Search Pokedex by</label>
            <select id="searchBy">
                    <option>Name</option>
                    <option>ID</option>
                </select>
        <input type="text" id="search">
        <button id="searchBtn">GO</button> 
    </p>

    <p>
        Add Pokemon
        <form id="addForm">
            No.:<input type="text" id="inNum">
            Name:<input type="text" id="inName">
            Type:<input type="text" id="inType">
            Height:<input type="text" id="inHeight">
            Weight:<input type="text" id="inWeight">
            Species:<input type="text" id="inSpecies">
            <input type="submit" id="Insert">
        </form>
    </p>

    <p>
        Change Pokemon
        <form id="updteForm">
            ID:<input type="text" id="upID">
            No.:<input type="text" id="upNum">
            Name:<input type="text" id="upName">
            Type:<input type="text" id="upType">
            Height:<input type="text" id="upHeight">
            Weight:<input type="text" id="upWeight">
            Species:<input type="text" id="upSpecies">
            <input type="submit" id="Update">
        </form>
    </p>

    <p>
        Delete Pokemon by Name: <input type="text" id="delete"><button id="deleteBtn">Delete</button>
    </p>


    <div id="pkmnList"></div>

    <div id="pkmnList2"></div>
 
</html>